<section class="heroSections">
  <section class="mainSectionBoxes">
    <div class="left-mainContainer">
      <h1>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Esse,
        praesentium tempore temporibus accusantium illo et explicabo quam sunt
        eligendi veritatis nihil in voluptatum fugiat dolorem dolore minima
        dolorum dolor distinctio modi dicta omnis libero debitis. Saepe sequi
        similique in consequatur repellendus, praesentium delectus distinctio.
        Nam perferendis nisi natus obcaecati doloremque.
      </h1>
    </div>
    <div class="mainContainer">
      <div class="headerWrapper">
        <div class="headerDiv">
          <!-- <p>Curated Just For You</p> -->
          <h1>Albums for You</h1>
        </div>
      </div>
      <div class="rightAreaButtons">
        <button class="playAllButton buttons">
          <svg
            width="20px"
            height="20px"
            viewBox="0 0 24 24"
            fill="#333"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
          </svg>
          Play All
        </button>
      </div>
      <section class="albumList">
        <ul class="albumItems">
          <li class="albumItem">
            <div class="albumCover">
              <img
                src="./assets/images/bollywood-lofi.png"
                alt="Bollywood Lo-Fi"
              />
            </div>
            <div class="albumDetails">
              <h2>Bollywood Lo-Fi</h2>
              <p>Arijit Singh, Pritam, Bollywood Lo-Fi, and more</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img
                src="./assets/images/ishq-sufiyana.png"
                alt="Ishq Sufiyana"
              />
            </div>
            <div class="albumDetails">
              <h2>Ishq Sufiyana</h2>
              <p>Arijit Singh, Shreya Ghoshal, Rahat Fateh Ali Khan</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img
                src="./assets/boxImage/malyalam.png"
                alt="Malayalam Melodies"
              />
            </div>
            <div class="albumDetails">
              <h2>Malayalam Melodies</h2>
              <p>Vineeth Sreenivasan, Shreya Ghoshal, and more</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img
                src="./assets/boxImage/retro-hindi.png"
                alt="Easy Breezy Retro: Hindi"
              />
            </div>
            <div class="albumDetails">
              <h2>Easy Breezy Retro: Hindi</h2>
              <p>Lata Mangeshkar, Kishore Kumar, Asha Bhosle</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img src="./assets/boxImage/telugu.png" alt="00s Chill: Telugu" />
            </div>
            <div class="albumDetails">
              <h2>00s Chill: Telugu</h2>
              <p>K.S. Chithra, Sumangali, Hariharan</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img src="./assets/boxImage/uncut.png" alt="Uncut Bollywood" />
            </div>
            <div class="albumDetails">
              <h2>Uncut Bollywood</h2>
              <p>Arijit Singh, Pritam, Sachet Parampara, and more</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
        </ul>
      </section>
    </div>

    <div class="mainContainer">
      <div class="headerWrapper">
        <div class="headerDiv">
          <p>Curated Just For You</p>
          <h1>Albums for You</h1>
        </div>
      </div>
      <div class="rightAreaButtons">
        <button class="playAllButton buttons">
          <svg
            width="20px"
            height="20px"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
          </svg>
          Play All
        </button>
      </div>
      <section class="albumList">
        <ul class="albumItems">
          <li class="albumItem">
            <div class="albumCover">
              <img
                src="./assets/images/bollywood-lofi.png"
                alt="Bollywood Lo-Fi"
              />
            </div>
            <div class="albumDetails">
              <h2>Bollywood Lo-Fi</h2>
              <p>Arijit Singh, Pritam, Bollywood Lo-Fi, and more</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img
                src="./assets/images/ishq-sufiyana.png"
                alt="Ishq Sufiyana"
              />
            </div>
            <div class="albumDetails">
              <h2>Ishq Sufiyana</h2>
              <p>Arijit Singh, Shreya Ghoshal, Rahat Fateh Ali Khan</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img
                src="./assets/boxImage/malyalam.png"
                alt="Malayalam Melodies"
              />
            </div>
            <div class="albumDetails">
              <h2>Malayalam Melodies</h2>
              <p>Vineeth Sreenivasan, Shreya Ghoshal, and more</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img
                src="./assets/boxImage/retro-hindi.png"
                alt="Easy Breezy Retro: Hindi"
              />
            </div>
            <div class="albumDetails">
              <h2>Easy Breezy Retro: Hindi</h2>
              <p>Lata Mangeshkar, Kishore Kumar, Asha Bhosle</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img src="./assets/boxImage/telugu.png" alt="00s Chill: Telugu" />
            </div>
            <div class="albumDetails">
              <h2>00s Chill: Telugu</h2>
              <p>K.S. Chithra, Sumangali, Hariharan</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
          <li class="albumItem">
            <div class="albumCover">
              <img src="./assets/boxImage/uncut.png" alt="Uncut Bollywood" />
            </div>
            <div class="albumDetails">
              <h2>Uncut Bollywood</h2>
              <p>Arijit Singh, Pritam, Sachet Parampara, and more</p>
            </div>
            <button class="playButton">
              <svg
                width="20px"
                height="20px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
              </svg>
            </button>
          </li>
        </ul>
      </section>
    </div>
    <!-- Circular Artist Carousel -->
    <section class="artistsContainer">
      <div class="artists">
        <img
          class="img1"
          src="./assets/images/artists/the weekend.jpg"
          alt=""
        />
        <img
          class="img2"
          src="./assets/images/artists/alan walker.jpg"
          alt=""
        />
        <img class="img3" src="./assets/images/artists/anne merie.jpg" alt="" />
        <img
          class="img4"
          src="./assets/images/artists/charlie puth.jpg"
          alt=""
        />
        <img
          class="img5"
          src="./assets/images/artists/imagine dragons.jpg"
          alt=""
        />
      </div>
    </section>
    <section>
      <div class="now-playing-bar show-player">
        <div class="song-info">
          <div class="img-container">
            <div class="song-cover">
              <img src="./assets/images/bollywood-lofi.png" alt="Song Cover" />
            </div>
          </div>
          <div class="song-details">
            <h4 id="song-title">Bollywood Lo-Fi</h4>
            <p id="artist">Arijit Singh, Pritam</p>
          </div>
          <span id="current-time">0:00</span> /
          <span id="duration">0:00</span>
        </div>
        <audio id="player-audio" preload="metadata"></audio>
        <input type="range" id="progress-bar" min="0" max="100" value="0" />
        <div class="player-controls">
          <button class="control-btn" id="prev-btn" aria-label="Previous Song">
            <svg
              width="20px"
              height="20px"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M15 18V6L7 12L15 18Z" fill="currentColor" />
              <path d="M5 6H3V18H5V6Z" fill="currentColor" />
            </svg>
          </button>
          <button class="control-btn play-btn" aria-label="Play/Pause">
            <svg
              width="20px"
              height="20px"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M8 5V19L19 12L8 5Z" fill="currentColor" />
            </svg>
          </button>
          <button class="control-btn" id="next-btn" aria-label="Next Song">
            <svg
              width="20px"
              height="20px"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M9 6V18L17 12L9 6Z" fill="currentColor" />
              <path d="M19 6H21V18H19V6Z" fill="currentColor" />
            </svg>
          </button>
          <div class="progress-container">
            <div class="progress-bar"></div>
          </div>
        </div>
        <div class="volume-controls">
          <button class="control-btn" aria-label="Mute/Unmute">
            <svg
              width="20px"
              height="20px"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12 4V2H6V8H2V16H6V22H12V20H8V16H10L14 12L10 8H8V4H12Z"
                fill="currentColor"
              />
              <path
                d="M16 8C17.1046 8 18 8.89543 18 10V14C18 15.1046 17.1046 16 16 16"
                stroke="currentColor"
                stroke-width="2"
              />
            </svg>
          </button>
          <div class="volume-slider">
            <input
              type="range"
              id="volume"
              min="0"
              max="1"
              step="0.1"
              value="1"
            />
          </div>
        </div>
      </div>
    </section>

    <section class="songPlaylist hidden">
      <div class="song-list">
        <h1>bollywood-lofi</h1>
        <div class="song-item">
          <audio
            src="./assets/music/Namo_Namo_-_Kedarnath.mp3"
            preload="metadata"
          ></audio>
          <p class="song-title">Namo Namo - Kedarnath</p>

          <button class="play-btn">Play</button>
        </div>
        <div class="song-item">
          <audio src="./assets/music/Mercy.mp3" preload="metadata"></audio>
          <p class="song-title">Ishq Sufiyana - Arijit Singh, Shreya Ghoshal</p>
          <button class="play-btn">Play</button>
        </div>
        <div class="song-item">
          <audio
            src="./assets/music/Raat_Bhar-(Mr-Jatt.com).mp3"
            preload="metadata"
          ></audio>
          <p class="song-title">Malayalam Melodies - Vineeth Sreenivasan</p>
          <button class="play-btn">Play</button>
        </div>
        <div class="song-item">
          <audio
            src="./assets/audio/retro-hindi.mp3"
            preload="metadata"
          ></audio>
          <p class="song-title">Easy Breezy Retro: Hindi - Lata Mangeshkar</p>
          <button class="play-btn">Play</button>
        </div>
        <div class="song-item">
          <audio
            src="./assets/audio/telugu-chill.mp3"
            preload="metadata"
          ></audio>
          <p class="song-title">00s Chill: Telugu - K.S. Chithra</p>
          <button class="play-btn">Play</button>
        </div>
        <div class="song-item">
          <audio
            src="./assets/audio/uncut-bollywood.mp3"
            preload="metadata"
          ></audio>
          <p class="song-title">Uncut Bollywood - Arijit Singh, Pritam</p>
          <button class="play-btn">Play</button>
        </div>
        <div class="song-item">
          <audio src="./assets/audio/feel-good.mp3" preload="metadata"></audio>
          <p class="song-title">Feel Good - Various Artists</p>
          <button class="play-btn">Play</button>
        </div>
      </div>
    </section>
  </section>
</section>

<div class="grid grid-cols-3 grid-rows-3 gap-10">
  <div class="col-span-3">1</div>
  <div class="col-span-2 row-start-2">7</div>
  <div class="row-span-2 col-start-3 row-start-2">8</div>
  <div class="row-start-3">9</div>
  <div class="row-start-3">10</div>
</div>

<section class="genre-sec">
  <div class="hero-container">
    <div class="hero-header">
      <div class="genre-Div-h1">Find Your Mood</div>
    </div>
    <div class="featured-genres">
      <div class="genre-Div" data-genre="Podcasts">Podcasts</div>
      <div class="genre-Div" data-genre="Romance">Romance</div>
      <div class="genre-Div" data-genre="Party">Party</div>
    </div>
    <div class="genre-container">
      <button class="genre-Div" data-genre="Relax">Relax</button>
      <button class="genre-Div" data-genre="Feel Good">Feel Good</button>
      <button class="genre-Div" data-genre="Energise">Energise</button>
      <button class="genre-Div" data-genre="Commute">Commute</button>
      <button class="genre-Div" data-genre="Sad">Sad</button>
      <button class="genre-Div" data-genre="Work out">Work out</button>
      <button class="genre-Div" data-genre="Focus">Focus</button>
      <button class="genre-Div" data-genre="Sleep">Sleep</button>
    </div>
  </div>

  <div class="genre-playlists">
    <!-- Placeholder playlists (to be populated via API) -->
    <div class="playlist-card">
      <div class="playlist-info">
        <h3>ROCKSTAR (feat. Roddy Ricch)</h3>
        <p>DaBaby</p>
      </div>
    </div>
    <div class="playlist-card">
      <div class="playlist-info">
        <h3>WUNNA</h3>
        <p>Gunna</p>
      </div>
    </div>
    <div class="playlist-card">
      <div class="playlist-info">
        <h3>Solitaires (feat. Travis Scott)</h3>
        <p>Future</p>
      </div>
    </div>
    <div class="playlist-card">
      <div class="playlist-info">
        <h3>Flex (feat. Juice WRLD)</h3>
        <p>Polo G</p>
      </div>
    </div>
    <div class="playlist-card">
      <div class="playlist-info">
        <h3>Chicago Freestyle (feat. Giveon)</h3>
        <p>Drake</p>
      </div>
    </div>
  </div>
</section>

<script>
  const CLIENT_ID = "9e34b610040644729bce32ef2b9081c3";
  const CLIENT_SECRET = "29f26872f8474bf2a9530a43953873ab";

  const APIController = (function () {
    const _getToken = async () => {
      try {
        const result = await fetch("http://localhost:3000/token");
        if (!result.ok) {
          const errorText = await result.text();
          throw new Error(
            `Failed to fetch token: ${result.status} ${result.statusText} - ${errorText}`
          );
        }
        const data = await result.json();
        console.log("Access Token:", data.access_token);
        return data.access_token;
      } catch (error) {
        console.error("Error fetching token:", error);
        throw error;
      }
    };

    const _getGenres = async (token) => {
      if (!token) throw new Error("No token provided");
      try {
        const result = await fetch(
          `https://api.spotify.com/v1/browse/categories?limit=50`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
            },
          }
        );
        if (!result.ok) {
          const errMessage = `Failed to fetch genres: ${result.status} ${result.statusText}`;
          console.error(errMessage);
          throw new Error("Failed to fetch genres");
        }
        const data = await result.json();
        console.log("Categories response:", data); // Log full response for debugging
        return data.categories.items.map((category) => ({
          id: category.id,
          name: category.name,
        }));
      } catch (error) {
        console.error("Error fetching genres:", error);
        throw error;
      }
    };
    const _getPlayListGenres = async (token, categoryId) => {
      const limit = 10;
      try {
        const result = await fetch(
          `https://api.spotify.com/v1/browse/categories/${categoryId}/playlists?limit=${limit}`,
          {
            method: "GET",
            headers: { Authorization: `Bearer ${token}` },
          }
        );

        if (result.status === 404) {
          console.warn(`Category ${categoryId} not found or not accessible`);
          return [];
        }

        if (!result.ok) {
          const errorText = await result.text();
          throw new Error(
            `Failed to fetch playlists: ${result.status} ${result.statusText} - ${errorText}`
          );
        }

        const data = await result.json();
        return data.playlists?.items || [];
      } catch (error) {
        console.error(
          `Error fetching playlists for category ${categoryId}:`,
          error
        );
        return [];
      }
    };

    const _getPlaylist = async (token, playlistId, market = "US") => {
      try {
        const url = new URL(` ABOVE_URL `);
        url.searchParams.append("market", market);

        const result = await fetch(url, {
          method: "GET",
          headers: { Authorization: `Bearer ${token}` },
        });

        if (!result.ok) {
          const errorText = await result.text();
          throw new Error(
            `Failed to fetch playlist: ${result.status} ${result.statusText} - ${errorText}`
          );
        }

        const data = await result.json();
        console.log("Playlist response:", data);
        return data;
      } catch (error) {
        console.error(`Error fetching playlist ${playlistId}:`, error);
        throw error;
      }
    };

    const _getTracks = async (token, tracksEndPoint) => {
      const limit = 10;
      try {
        const result = await fetch(`${tracksEndPoint}?limit=${limit}`, {
          method: "GET",
          headers: {
            Authorization: "Bearer " + token,
          },
        });
        if (!result.ok) throw new Error("Failed to fetch tracks");
        const data = await result.json();
        return data.tracks.items || [];
      } catch (error) {
        console.error("Error fetching tracks:", error);
        throw error;
      }
    };

    const _getTrack = async (token, trackEndPoint) => {
      try {
        const result = await fetch(trackEndPoint, {
          method: "GET",
          headers: {
            Authorization: "Bearer " + token,
          },
        });
        if (!result.ok) throw new Error("Failed to fetch track");
        const data = await result.json();
        return data;
      } catch (error) {
        console.error("Error fetching track:", error);
        throw error;
      }
    };

    return {
      getToken() {
        return _getToken();
      },
      getGenres(token) {
        return _getGenres(token);
      },
      getPlaylistByGenre(token, categoryId) {
        return _getPlayListGenres(token, categoryId);
      },
      getTracks(token, tracksEndPoint) {
        return _getTracks(token, tracksEndPoint);
      },
      getTrack(token, trackEndPoint) {
        return _getTrack(token, trackEndPoint);
      },
      getPlaylist(token, playlistId, market) {
        return _getPlaylist(token, playlistId, market);
      },
    };
  })();

  const token = APIController.getToken();
  const playlists = APIController.getPlaylistByGenre(
    token,
    "3cEYpjA9oz9GiPac4AsH4n",
    "US"
  );

  console.log("playlists", playlists);

  const UIController = (function () {
    const DOMElements = {
      genreDiv: "#select_genre",
      selectPlaylist: "#select_playlist",
      btnSubmit: "#btn_submit",
      divSongDetails: "#song-detail",
      hfToken: "#hidden_token",
      divSongList: ".song-list",
      playlistDetail: "#playlist-detail",
      errMessage: "#error-message",
    };

    return {
      inputField() {
        return {
          genre: document.querySelector(DOMElements.genreDiv),
          playlist: document.querySelector(DOMElements.selectPlaylist),
          submit: document.querySelector(DOMElements.btnSubmit),
          token: document.querySelector(DOMElements.hfToken),
          tracks: document.querySelector(DOMElements.divSongList),
          songDetail: document.querySelector(DOMElements.divSongDetails),
          playlistDetail: document.querySelector(DOMElements.playlistDetail),
          errorDiv: document.querySelector(DOMElements.errMessage),
        };
      },

      displayError(message) {
        const errorDiv = document.querySelector(DOMElements.errMessage);
        errorDiv.innerHTML = `<p style="color: red;">${message}</p>`;
      },

      clearError() {
        const clearDiv = document.querySelector(DOMElements.errMessage);
        clearDiv.innerHTML = "";
      },

      createPlaylistDetail(name, description, owner, image) {
        const detailDiv = document.querySelector(DOMElements.playlistDetail);
        detailDiv.innerHTML = `
        <h3>${name}</h3>
        <p>${description || "No description"}</p>
        <p>Created by: ${owner.display_name || owner.id}</p>
        <img src="${image}" alt="Playlist Cover" />
      `;
      },

      createGenres(text, value) {
        if (!value || !text || value.length > 50) {
          // Skip invalid or overly long IDs
          console.warn(`Skipping invalid genre: id=${value}, name=${text}`);
          return;
        }
        const html = `<option value="${value}">${text}</option>`;
        document
          .querySelector(DOMElements.genreDiv)
          .insertAdjacentHTML("beforeend", html);
      },

      createPlaylist(text, value) {
        if (!value || !text) {
          console.warn(
            `Skipping invalid playlist: value=${value}, name=${text}`
          );
          return;
        }
        const html = `<option value="${value}">${text}</option>`;
        document
          .querySelector(DOMElements.selectPlaylist)
          .insertAdjacentHTML("beforeend", html);
      },

      createTrack(id, name, artist) {
        if (!id || !name) return;
        const artistsNames = artist.map((artist) => artist.name).join(", ");
        const html = `<a href="#" class="song" id="${id}">${name} - ${artistsNames}</a>`;
        document
          .querySelector(DOMElements.divSongList)
          .insertAdjacentHTML("beforeend", html);
      },

      createTrackDetails(artists, title, img) {
        const detailDiv = document.querySelector(DOMElements.divSongDetails);
        detailDiv.innerHTML = "";
        const html = `
        <div class="img-container">
          <div class="song-cover">
            <img src="${img}" alt="Song Cover" />
          </div>
        </div>
        <div class="song-details">
          <h4 id="song-title">${title}</h4>
          <p id="artist">${artists}</p>
        </div>
        <span id="current-time">0:00</span> /
        <span id="duration">0:00</span>
      `;
        detailDiv.insertAdjacentHTML("beforeend", html);
      },

      resetTrackDetails() {
        this.inputField().songDetail.innerHTML = "";
      },

      resetTracks() {
        this.inputField().tracks.innerHTML = "";
        this.resetTrackDetails();
      },

      resetPlaylist() {
        this.inputField().playlist.innerHTML =
          '<option value="">Select...</option>';
        this.resetTracks();
      },

      storeToken(value) {
        document.querySelector(DOMElements.hfToken).value = value;
      },

      getStoredToken() {
        return {
          token: document.querySelector(DOMElements.hfToken).value,
        };
      },
    };
  })();

  const APPController = (function (UICtrl, APICtrl) {
    const DOMInputs = UICtrl.inputField();

    const loadGenres = async () => {
      try {
        const token = await APICtrl.getToken();
        UICtrl.storeToken(token);
        const genres = await APICtrl.getGenres(token);
        genres.forEach((genre) => {
          if (genre && genre.id && genre.name) {
            console.log(`Adding genre: id=${genre.id}, name=${genre.name}`); // Debug
            UICtrl.createGenres(genre.name, genre.id);
          } else {
            console.warn("Skipping invalid genre:", genre);
          }
        });
      } catch (error) {
        console.error("Error loading genres:", error);
      }
    };

    const loadPlaylist = async (playlistId) => {
      try {
        const token = UICtrl.getStoredToken().token;
        const playlist = await APICtrl.getPlaylist(
          token,
          playlistId,
          "IN",
          "name,description,owner(display_name,id),tracks.items(track(name,href,artists(name)))"
        );

        UICtrl.createPlaylistDetail(
          playlist.name,
          playlist.description,
          playlist.owner,
          playlist.images[0].url
        );

        //Display Tracks

        UICtrl.resetTracks();
        playlist.tracks.forEach((item) => {
          if (item.track) {
            UICtrl.createTrack(
              item.track.href,
              item.track.name,
              item.track.artists
            );
          }
        });
      } catch (error) {
        console.error("Error loading playlist details:", error);
      }
    };

    DOMInputs.genre.addEventListener("change", async () => {
      UICtrl.resetPlaylist();
      UICtrl.clearError();
      try {
        const token = UICtrl.getStoredToken().token;
        const categoryId = DOMInputs.genre.value;
        if (!categoryId) return;

        const playlists = await APICtrl.getPlaylistByGenre(token, categoryId);
        if (playlists.length === 0) {
          UICtrl.displayError(`No playlists found for category ${categoryId}`);
        }
        playlists.forEach((playlist) => {
          if (playlist?.id && playlist.name) {
            UICtrl.createPlaylist(playlist.name, playlist.id);
          }
        });
      } catch (error) {
        UICtrl.displayError(`Error loading playlists: ${error.message}`);
      }
    });

    DOMInputs.submit.addEventListener("click", async (e) => {
      e.preventDefault();
      UICtrl.resetTracks();
      try {
        const token = UICtrl.getStoredToken().token;
        const playlistSelect = DOMInputs.playlist;
        const tracksEndPoint = playlistSelect.value;
        if (!tracksEndPoint) return;
        const tracks = await APICtrl.getTracks(token, tracksEndPoint);
        tracks.forEach((el) => {
          if (el && el.track && el.track.href && el.track.name) {
            UICtrl.createTrack(el.track.href, el.track.name);
          }
        });
      } catch (error) {
        console.error("Error loading tracks:", error);
      }
    });

    DOMInputs.tracks.addEventListener("click", async (e) => {
      e.preventDefault();
      if (!e.target.classList.contains("song")) return;
      UICtrl.resetTrackDetails();
      try {
        const token = UICtrl.getStoredToken().token;
        const trackEndpoint = e.target.id;
        const track = await APICtrl.getTrack(token, trackEndpoint);
        const artistNames = track.artists
          .map((artist) => artist.name)
          .join(", ");
        UICtrl.createTrackDetails(
          artistNames,
          track.name,
          track.album.images[0].url
        );
      } catch (error) {
        console.error("Error loading track details:", error);
      }
    });

    return {
      init() {
        console.log("App initialized");
        loadGenres();
        loadPlaylist("3cEYpjA9oz9GiPac4AsH4n");
      },
    };
  })(UIController, APIController);

  APPController.init();
</script>
